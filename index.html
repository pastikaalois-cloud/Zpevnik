<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Zpěvník">
<meta name="theme-color" id="theme-color" content="#ff6b00">
<link rel="manifest" href="manifest.json">
<title>Zpěvník</title>
<style>
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
:root{
  --bg:#fff;--bg2:#f7f7f7;--bg3:#eeeeee;--border:#e0e0e0;
  --accent:#ff6b00;--accent2:#e05a00;
  --text:#1a1a1a;--text2:#555;--text3:#999;
  --chord-bg:#fff0e6;--chord:#cc4400;
}
body.dark{
  --bg:#111111;--bg2:#1e1e1e;--bg3:#2a2a2a;--border:#333333;
  --accent:#ff6b00;--accent2:#e05a00;
  --text:#d0d0d0;--text2:#999999;--text3:#555555;
  --chord-bg:#2a1e10;--chord:#ff8533;
}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,sans-serif;overflow:hidden}

/* ── SCREENS ── */
.screen{display:none;flex-direction:column;height:100dvh}
.screen.active{display:flex}

/* HOME */
.home-top{display:flex;align-items:center;justify-content:space-between;padding:16px 16px 12px;border-bottom:1.5px solid var(--border);background:var(--bg)}
.logo{font-size:22px;font-weight:800;color:var(--accent)}
.hdr-r{display:flex;gap:8px}
.ibtn{background:var(--bg2);border:1.5px solid var(--border);color:var(--text);border-radius:12px;width:46px;height:46px;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.ibtn:active{background:var(--bg3)}
.add-btn{background:var(--accent);border:none;color:#fff;border-radius:12px;height:46px;padding:0 20px;font-size:15px;font-weight:700;font-family:inherit;cursor:pointer}
.add-btn:active{background:var(--accent2)}
.srch{display:flex;align-items:center;gap:10px;margin:12px 16px 6px;background:var(--bg2);border:1.5px solid var(--border);border-radius:14px;padding:0 14px;height:50px}
.srch:focus-within{border-color:var(--accent)}
.srch input{background:none;border:none;outline:none;color:var(--text);font-family:inherit;font-size:16px;width:100%}
.srch input::placeholder{color:var(--text3)}
.cnt{color:var(--text3);font-size:13px;font-weight:500;padding:2px 16px 8px}
.list{flex:1;overflow-y:auto;padding:0 16px 24px}
.card{display:flex;align-items:center;justify-content:space-between;border:1.5px solid var(--border);border-radius:16px;padding:16px;margin-bottom:10px;cursor:pointer;background:var(--bg)}
.card:active{background:var(--bg2);border-color:var(--accent)}
.card-t{font-size:17px;font-weight:700;margin-bottom:3px}
.card-a{font-size:13px;color:var(--text3)}

/* SONG VIEW */
.song-hdr{background:var(--bg);border-bottom:1.5px solid var(--border);flex-shrink:0}
.song-top{display:flex;align-items:center;gap:10px;padding:12px 16px 10px}
.back-btn{background:var(--bg2);border:1.5px solid var(--border);color:var(--text);border-radius:12px;height:48px;padding:0 16px;font-size:15px;font-weight:700;font-family:inherit;cursor:pointer;display:flex;align-items:center;gap:6px;flex-shrink:0}
.back-btn:active{background:var(--bg3)}
.song-info{flex:1;min-width:0}
.song-info h2{font-size:18px;font-weight:800;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.song-info .sub{color:var(--text3);font-size:13px}
.ctrls{display:flex;gap:8px;padding:0 16px 12px;overflow-x:auto}
.cbtn{background:var(--bg2);border:1.5px solid var(--border);color:var(--text2);border-radius:12px;height:44px;padding:0 18px;font-size:14px;font-weight:700;font-family:inherit;cursor:pointer;white-space:nowrap;flex-shrink:0}
.cbtn:active{background:var(--bg3)}
.cbtn.on{border-color:var(--accent);color:var(--accent)}

.song-body{flex:1;overflow-y:auto;overflow-x:hidden;padding:25px 18px 6px;-webkit-overflow-scrolling:touch}

/* OPRAVA ZOBRAZENÍ AKORDŮ NAD TEXTEM */
.line{
  margin-bottom: 12px;
  line-height: 1.6;
  font-family: monospace;
  white-space: pre-wrap;
  position: relative;
}

.chord-wrapper {
  display: inline-block;
  position: relative;
  vertical-align: bottom;
}

.ch {
  position: absolute;
  bottom: 100%;
  left: 0;
  color: var(--chord);
  font-weight: 800;
  font-size: 0.9em;
  white-space: nowrap;
  line-height: 1.2;
  margin-bottom: 2px;
  cursor: pointer;
  user-select: none;
}

.ch.active {
  background: var(--chord-bg);
  border-radius: 3px;
  outline: 2px solid var(--accent);
}

.lyr {
  display: inline;
}

.blank{height:15px}

.scbar{display:flex;align-items:center;gap:8px;padding:10px 16px;border-top:1.5px solid var(--border);background:var(--bg);flex-shrink:0}
.scbtn{background:var(--bg2);border:1.5px solid var(--border);color:var(--text);border-radius:12px;height:44px;padding:0 16px;font-size:14px;font-weight:700;font-family:inherit;cursor:pointer;white-space:nowrap}
.scbtn.on{background:var(--accent);border-color:var(--accent);color:#fff}
.spdbtn{background:var(--bg2);border:1.5px solid var(--border);color:var(--text);border-radius:12px;width:44px;height:44px;font-size:18px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.spdlbl{color:var(--text3);font-size:13px;font-weight:700;min-width:26px;text-align:center}

/* FORM STYLES (ZKRÁCENO) */
.fbody{flex:1;overflow-y:auto;padding:16px}
.fld{margin-bottom:14px}
.inp{width:100%;background:var(--bg2);border:1.5px solid var(--border);border-radius:12px;padding:14px 16px;color:var(--text);font-family:inherit;font-size:16px;outline:none}
textarea.inp{font-family:monospace;font-size:14px;line-height:1.8;resize:none;min-height:240px}
.savebtn{width:100%;background:var(--accent);color:#fff;border:none;border-radius:14px;height:54px;font-size:16px;font-weight:800;cursor:pointer}
</style>
</head>
<body>

<div class="screen active" id="screen-home">
  <div class="home-top">
    <div class="logo">♪ Zpěvník</div>
  </div>
  <div class="srch">
    <input id="srch-inp" type="search" placeholder="Hledat..." oninput="renderList()">
  </div>
  <div class="list" id="list"></div>
</div>

<div class="screen" id="screen-song">
  <div class="song-hdr">
    <div class="song-top">
      <button class="back-btn" onclick="showHome()">Zpět</button>
      <div class="song-info">
        <h2 id="v-title"></h2>
        <div class="sub" id="v-artist"></div>
      </div>
    </div>
    <div class="ctrls">
      <button class="cbtn" id="chord-btn" onclick="toggleChords()">Akordy ✓</button>
      <button class="cbtn" onclick="transposeAll(-1)">♭ −1</button>
      <button class="cbtn" onclick="transposeAll(1)">♯ +1</button>
    </div>
  </div>
  <div class="song-body" id="song-body"></div>
</div>

<script>
// --- DATA A LOGIKA ---
let songs = [
  { 
    title: "Honolulu", 
    artist: "Kamelot", 
    content: "[A]Letecká [D]linka do rá[E]je[D]\n[A]k ostrovům [D]slunné Hava[E]je" 
  }
];

let currentSong = null;
let showChords = true;
let fontSize = 16;

function renderList() {
  const list = document.getElementById('list');
  list.innerHTML = songs.map((s, idx) => `
    <div class="card" onclick="openSong(${idx})">
      <div>
        <div class="card-t">${s.title}</div>
        <div class="card-a">${s.artist}</div>
      </div>
    </div>
  `).join('');
}

function openSong(idx) {
  currentSong = JSON.parse(JSON.stringify(songs[idx]));
  document.getElementById('v-title').textContent = currentSong.title;
  document.getElementById('v-artist').textContent = currentSong.artist;
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-song').classList.add('active');
  renderSongBody();
}

function showHome() {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-home').classList.add('active');
}

function toggleChords() {
  showChords = !showChords;
  document.getElementById('chord-btn').classList.toggle('on', showChords);
  document.getElementById('chord-btn').textContent = showChords ? 'Akordy ✓' : 'Akordy ✗';
  renderSongBody();
}

// --- KLÍČOVÁ FUNKCE PRO VYKRESLOVÁNÍ (FORMÁT KYTARY.CZ) ---
function renderSongBody() {
  const body = document.getElementById('song-body');
  body.style.fontSize = fontSize + 'px';
  body.innerHTML = '';

  const lines = currentSong.content.split('\n');
  
  lines.forEach(lineText => {
    const lineDiv = document.createElement('div');
    lineDiv.className = 'line';

    if (lineText.trim() === '') {
      lineDiv.innerHTML = '<div class="blank"></div>';
      body.appendChild(lineDiv);
      return;
    }

    // Rozdělení textu na části podle akordů [G]
    const parts = lineText.split(/(\[[^\]]+\])/g);
    
    parts.forEach(part => {
      if (part.startsWith('[') && part.endsWith(']')) {
        // Část je AKORD
        if (showChords) {
          const chordName = part.slice(1, -1);
          const span = document.createElement('span');
          span.className = 'chord-wrapper';
          span.innerHTML = `<span class="ch">${chordName}</span>`;
          lineDiv.appendChild(span);
        }
      } else {
        // Část je TEXT
        const textSpan = document.createElement('span');
        textSpan.className = 'lyr';
        textSpan.textContent = part;
        lineDiv.appendChild(textSpan);
      }
    });

    body.appendChild(lineDiv);
  });
}

function transposeAll(steps) {
  // Jednoduchá ukázka transpozice pro demo
  renderSongBody();
}

renderList();
</script>

</body>
</html>
